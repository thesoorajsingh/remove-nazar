<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nazar Removal Service</title>
    <!-- Pixel Font -->
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-dark-red: #921E21;
            /* Main Background */
            --darkest-contrast: #1A0100;
            /* Text shadows, button deep shadow */
            --accent-orange: #F49D37;
            /* Title text, button glow */
            --light-text-color: #FEF1E6;
            /* General light text, photo frame border */
            --success-green: #1E3F20;
            /* Mission Accomplished text */
            --pixel-white: #ffffff;
            /* For salt grains */
            --game-text: 'Press Start 2P', cursive;
            /* FIX: Restored space in font name to ensure pixel font loads */
        }

        * {
            box-sizing: border-box;
            user-select: none;
        }

        body {
            margin: 0;
            padding: 0;
            background-color: var(--bg-dark-red);
            /* Updated background */
            font-family: var(--game-text);
            color: var(--light-text-color);
            /* General text color */
            overflow: hidden;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        /* --- UI Elements --- */
        .container {
            text-align: center;
            z-index: 10;
            width: 100%;
            max-width: 600px;
            padding: 20px;
            /* Default for desktop/larger screens - centered by flexbox */
            position: relative;
            top: 0;
            transform: none;
        }

        .subtitle-box {
            /* STYLING COPIED FROM OLD H1 */
            background: transparent;
            color: var(--light-text-color);
            /* CHANGED: Set to White/Light Text Color */
            text-shadow: 4px 4px 0px var(--darkest-contrast);
            /* Set to Title Shadow */

            padding: 5px;
            border: none;
            box-shadow: none;
            font-size: 1.0rem;
            /* FURTHER REDUCED size for narrower text */
            min-height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 0;
            margin-bottom: 20px;
            /* REDUCED separation from button */

            /* NEW: Ensure single line, lower case, and prevent resizing issues */
            white-space: nowrap;
            /* Forces text onto a single line */
            max-width: 90vw;
            /* Constraint to prevent cut-off on small screens */
            text-transform: lowercase;
            /* Makes all text lowercase */
        }

        #rotating-text {
            /* NEW: For the fade transition */
            opacity: 1;
            transition: opacity 0.3s ease-in-out;
        }

        /* 8-bit Button */
        .pixel-btn {
            background-color: var(--accent-orange);
            /* Button base color */
            color: var(--darkest-contrast);
            /* Button text color */
            font-family: var(--game-text);
            font-size: 1.7rem;
            /* INCREASED Button Font Size */
            border: none;
            padding: 30px 50px;
            /* INCREASED Button Padding */
            position: relative;
            cursor: pointer;
            box-shadow:
                inset -8px -8px 0px 0px #ab6a1f,
                /* Scaled up inset shadow to 8px */
                8px 8px 0px 0px var(--darkest-contrast);
            /* Scaled up overall shadow to 8px */
            /* FIX: Apply a counter-translation to visually center the button + shadow */
            transform: translate(-4px, -4px);
            animation: glowing 0.8s infinite alternate;
            /* SYNCED duration with emoji bounce (0.8s) */
            transition: transform 0.1s;
        }

        .pixel-btn:active {
            /* FIX: When active, shift 8px relative to the *original* position, which is 4px down/right from the new centered position */
            transform: translate(4px, 4px);
            box-shadow: inset -8px -8px 0px 0px #ab6a1f;
        }

        /* SYNCED GLOW DURATION: 0.8s */
        @keyframes glowing {
            0% {
                box-shadow: inset -8px -8px 0px 0px #ab6a1f, 0 0 10px var(--accent-orange), 8px 8px 0px 0px var(--darkest-contrast);
            }

            100% {
                box-shadow: inset -8px -8px 0 0 #ab6a1f, 0 0 25px #ffe066, 8px 8px 0 0 var(--darkest-contrast);
                filter: brightness(1.2);
            }
        }

        /* --- Good Luck Charms (Emojis) --- */
        .charm {
            position: absolute;
            font-size: 80px;
            /* Bigger size */
            z-index: 5;
            opacity: 0.9;
            animation: bounce 0.8s ease-in-out infinite alternate;
            /* 0.8s duration */
            filter: none;
        }

        .charm-tl {
            top: 30px;
            left: 30px;
            animation-delay: 0s;
        }

        .charm-tr {
            top: 30px;
            right: 30px;
            animation-delay: 0s;
        }

        .charm-bl {
            bottom: 30px;
            left: 30px;
            animation-delay: 0s;
        }

        .charm-br {
            bottom: 30px;
            right: 30px;
            animation-delay: 0s;
            letter-spacing: -10px;
        }

        .celebrate {
            z-index: 200 !important;
        }

        @keyframes bounce {
            0% {
                transform: translateY(0) scale(1);
            }

            100% {
                transform: translateY(-30px) scale(1.1);
            }
        }

        /* --- Ritual Stage --- */
        #ritual-stage {
            display: none;
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 20;
        }

        .photo-frame {
            position: relative;
            width: 300px;
            height: 300px;
            border: 8px solid var(--light-text-color);
            /* Updated frame border */
            box-shadow:
                0 0 0 8px var(--darkest-contrast),
                /* Updated frame inner shadow */
                15px 15px 0 rgba(0, 0, 0, 0.3);
            background: var(--darkest-contrast);
            /* Updated frame background */
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #user-photo {
            max-width: 100%;
            max-height: 100%;
            object-fit: cover;
            image-rendering: pixelated;
        }

        /* --- Sprites --- */
        .sprite {
            position: absolute;
            pointer-events: none;
            z-index: 50;
        }

        .emoji-sprite {
            font-size: 100px;
            text-align: center;
            line-height: 1;
            filter: drop-shadow(5px 5px 0px rgba(0, 0, 0, 0.2));
        }

        #hand-wrapper {
            position: absolute;
            width: 0px;
            height: 0px;
        }

        #hand-sprite {
            width: 120px;
            height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            transform: translate(-50%, -50%);
        }

        #shaker-sprite {
            display: none;
        }

        .salt-grain {
            position: absolute;
            width: 6px;
            height: 6px;
            background: var(--pixel-white);
            /* Salt color remains white */
            box-shadow: 1px 1px 0 #ccc;
            z-index: 60;
            pointer-events: none;
        }

        /* --- Success Screen --- */
        #success-screen {
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            z-index: 100;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
        }

        .mission-text {
            color: var(--accent-orange);
            /* Updated mission text color */
            font-size: 2rem;
            text-shadow: 4px 4px 0 var(--success-green);
            /* Updated mission text shadow */
            margin-bottom: 20px;
            animation: pulseText 2s infinite;
        }

        .reset-btn {
            background: var(--light-text-color);
            /* Reset button background */
            color: var(--darkest-contrast);
            /* Reset button text color */
            border: 4px solid var(--darkest-contrast);
            /* Reset button border */
            padding: 10px 20px;
            font-family: var(--game-text);
            cursor: pointer;
            margin-top: 30px;
        }

        @keyframes pulseText {
            0% {
                opacity: 1;
                transform: scale(1);
            }

            50% {
                opacity: 0.8;
                transform: scale(1.05);
            }

            100% {
                opacity: 1;
                transform: scale(1);
            }
        }

        @keyframes shakeAction {
            0% {
                transform: rotate(-45deg) translate(0, 0);
            }

            25% {
                transform: rotate(-65deg) translate(-5px, 0);
            }

            50% {
                transform: rotate(-45deg) translate(0, -5px);
            }

            75% {
                transform: rotate(-25deg) translate(5px, 0);
            }

            100% {
                transform: rotate(-45deg) translate(0, 0);
            }
        }

        .hidden {
            display: none !important;
        }

        .flex {
            display: flex !important;
        }

        @media (max-width: 600px) {
            .container {
                /* New approach: position absolutely and use calc to offset from 50% for visual centering */
                position: absolute;
                top: calc(50% - 70px);
                /* Adjust this value to move the block up/down for visual balance */
                left: 50%;
                transform: translateX(-50%);
                /* Ensures horizontal centering */
            }

            .subtitle-box {
                font-size: 0.9rem;
                max-width: 90vw;
            }

            /* Adjusted mobile font size */
            .charm {
                font-size: 60px;
            }

            /* LIFTING CHARMS FOR MOBILE SAFARI/CHROME BOTTOM UI */
            .charm-bl,
            .charm-br {
                bottom: 80px;
                /* Increased from 30px to clear mobile browser UI */
            }

            .pixel-btn {
                font-size: 1.4rem;
                padding: 25px 40px;
            }

            /* Adjusted button size for mobile */
            .photo-frame {
                width: 250px;
                height: 250px;
            }

            .emoji-sprite {
                font-size: 80px;
            }
        }
    </style>
</head>

<body>

    <!-- Good Luck Charms (Emojis) -->
    <div class="charm charm-tl">üßø</div>
    <div class="charm charm-tr">üçÄ</div>
    <div class="charm charm-bl">üß≤</div>
    <!-- Grouped Lemon and Chilli -->
    <div class="charm charm-br">üçãüå∂Ô∏è</div>

    <!-- Main Entry Screen -->
    <div id="start-screen" class="container">
        <!-- H1 Title Removed -->
        <div class="subtitle-box">
            <span id="rotating-text">Haters got you down?</span>
        </div>

        <button class="pixel-btn" onclick="document.getElementById('file-input').click()">REMOVE NAZAR</button>
        <input type="file" id="file-input" accept="image/*" style="display: none;" onchange="handleFileUpload(this)">

        <!-- NEW: Selfie instruction text -->
        <div
            style="color: var(--light-text-color); font-size: 0.7rem; margin-top: 24px; text-shadow: 2px 2px 0px var(--darkest-contrast); text-decoration: underline; opacity: 0.7;">
            upload a selfie to get started
        </div>
    </div>

    <!-- Ritual Animation Stage -->
    <div id="ritual-stage" class="hidden">
        <div class="photo-frame">
            <img id="user-photo" src="" alt="User Selfie">
        </div>

        <!-- The Shaker (Emoji) -->
        <div id="shaker-sprite" class="sprite emoji-sprite">üßÇ</div>

        <!-- Wrapper to handle position -->
        <div id="hand-wrapper">
            <!-- The Hand (Emoji) -->
            <div id="hand-sprite" class="emoji-sprite">üëãüèº</div>
        </div>
    </div>

    <!-- Success Screen -->
    <div id="success-screen">
        <div class="mission-text">MISSION<br>ACCOMPLISHED</div>
        <div style="color: var(--light-text-color); margin-top: 10px; font-size: 0.8rem;">NAZAR REMOVED SUCCESSFULLY
        </div>
        <button class="reset-btn" onclick="location.reload()">REMOVE MORE</button>
    </div>

    <script defer src="https://analytics.thesoorajsingh.me/script.js"
        data-website-id="8f8ea3da-22a2-4aad-b4b6-1d755e553f83"></script>

    <script>
        const phrases = ["haters got you down?", "in the trenches?", "bad luck day after day?", "feeling the evil eye?", "vibes are off?"];
        let phraseIndex = 0;
        const textElement = document.getElementById('rotating-text');

        function rotateText() {
            // 1. Fade out (Opacity 1 -> 0)
            textElement.style.opacity = 0;

            // Wait for the fade-out duration (350ms)
            setTimeout(() => {
                // 2. Update text content
                phraseIndex = (phraseIndex + 1) % phrases.length;
                textElement.innerText = phrases[phraseIndex];

                // 3. Fade in (Opacity 0 -> 1)
                textElement.style.opacity = 1;
            }, 350);
        }

        // Run immediately and then every 1.5 seconds
        rotateText();
        setInterval(rotateText, 1500);

        function handleFileUpload(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    document.getElementById('user-photo').src = e.target.result;
                    startRitual();
                }
                reader.readAsDataURL(input.files[0]);
            }
        }

        async function startRitual() {
            document.getElementById('start-screen').classList.add('hidden');
            const stage = document.getElementById('ritual-stage');
            stage.classList.remove('hidden');
            stage.classList.add('flex');

            const handWrapper = document.getElementById('hand-wrapper');
            const handSprite = document.getElementById('hand-sprite');
            const shaker = document.getElementById('shaker-sprite');

            // --- PHASE 1: SALTING ---

            // 1. Position Hand (Open Palm üëãüèº)
            // Rotate -90deg so fingers point left
            handSprite.innerText = "üëãüèº";
            handWrapper.style.transform = "translate(0, 0)"; // Reset wrapper transform
            // Hand position: left of center
            const handPosX = -100;
            const handPosY = 50;

            handWrapper.style.left = `calc(50% + ${handPosX}px)`; // Position to the left of center
            handWrapper.style.top = `calc(50% + ${handPosY}px)`; // Slightly below center

            handSprite.style.transition = "transform 0.5s ease";
            handSprite.style.transform = "translate(-50%, -50%) rotate(-90deg)"; // Hand rotated to face left

            // 2. Position Shaker (üßÇ)
            shaker.style.display = "block";
            shaker.style.transform = "rotate(-45deg)"; // Initial shake angle

            // Shaker position: directly above the hand (same X, offset Y)
            const shakerPosY = handPosY - 150; // Place shaker 150px above the hand
            shaker.style.left = `calc(50% + ${handPosX}px)`;
            shaker.style.top = `calc(50% + ${shakerPosY}px)`;

            // 3. SPRINKLE ANIMATION
            // Increased salt particle count per shake (from 1 to 8)
            for (let i = 0; i < 5; i++) {
                shaker.style.animation = "shakeAction 0.3s ease";
                createSaltParticles(shaker, false, 8); // Now dropping 8 particles per shake
                await new Promise(r => setTimeout(r, 400));
                shaker.style.animation = "none";
                await new Promise(r => setTimeout(r, 100));
            }

            // --- PHASE 2: ROTATION PREP ---

            shaker.style.display = "none";

            // Switch to Pinched Hand (ü§åüèº)
            handSprite.innerText = "ü§åüèº";

            // Reset hand sprite rotation to 0 (Upright)
            handSprite.style.transition = "transform 0.5s ease";
            handSprite.style.transform = "translate(-50%, -50%) rotate(0deg)";

            // Move wrapper to start position for orbit (top of circle)
            const radius = 220;
            const centerOffset = { x: 0, y: 0 }; // Photo is at center

            // Initial position of hand wrapper for orbit (top of the circle)
            handWrapper.style.transition = "top 1s ease, left 1s ease";
            handWrapper.style.left = `calc(50% + ${centerOffset.x}px)`;
            handWrapper.style.top = `calc(50% + ${centerOffset.y - radius}px)`;

            await new Promise(r => setTimeout(r, 1000));

            // --- PHASE 3: THE 7 CIRCLES (Perfect Circular Orbit + Salt Drip) ---
            const rotations = 7;
            const durationPerRotation = 2500; // Increased duration for slower rotation
            const startTime = performance.now();
            let rotationsCompleted = 0;

            // Crucial: Clear transitions to prevent them from interfering with RAF positioning
            handWrapper.style.transition = "none";

            await new Promise(resolve => {
                function animate(currentTime) {
                    const elapsed = currentTime - startTime;
                    const totalDuration = rotations * durationPerRotation;

                    if (elapsed < totalDuration) {
                        // Current progress in terms of full rotations (e.g., 0.5, 1.2, 2.7)
                        const currentRotationProgress = elapsed / durationPerRotation;

                        // Check if a new rotation has started
                        const currentRotation = Math.floor(currentRotationProgress);
                        if (currentRotation > rotationsCompleted) {
                            // Drop random 1-3 salt particles at the start of the new rotation
                            const drops = Math.floor(Math.random() * 3) + 1;
                            createSaltParticles(handWrapper, true, drops);
                            rotationsCompleted = currentRotation;
                        }

                        // Total angle swept from the top (-Math.PI / 2 is 12 o'clock)
                        const angle = -Math.PI / 2 + (currentRotationProgress * 2 * Math.PI);

                        // Calculate perfect circular coordinates centered at (0, 0)
                        const x = Math.cos(angle) * radius;
                        const y = Math.sin(angle) * radius;

                        // Set wrapper position relative to screen center (50%, 50%)
                        handWrapper.style.left = `calc(50% + ${centerOffset.x + x}px)`;
                        handWrapper.style.top = `calc(50% + ${centerOffset.y + y}px)`;

                        // Hand sprite remains upright (rotate(0deg)) within the wrapper.

                        requestAnimationFrame(animate);
                    } else {
                        // After 7 full rotations, finalize position
                        resolve();
                    }
                }
                requestAnimationFrame(animate);
            });

            // --- PHASE 4: THE THROW (Downwards facing rotation) ---

            // Re-enable transitions for smooth throwing motion
            handWrapper.style.transition = "left 1s ease-in-out, top 1s ease-in-out";
            handSprite.style.transition = "transform 0.5s ease-in-out";

            // Move hand to the right (throw position) - Use vw for responsiveness and visibility
            handWrapper.style.left = "90vw"; // Changed from "calc(50% + 300px)"
            handWrapper.style.top = "50%";

            // Simultaneously rotate the hand sprite within its wrapper to face downwards
            handSprite.style.transform = "translate(-50%, -50%) rotate(180deg)";

            await new Promise(r => setTimeout(r, 1000));

            // 2. Sprinkle Salt Downwards (Discarding)
            for (let k = 0; k < 20; k++) {
                createSaltParticles(handWrapper, true, 3); // More salt when throwing
                await new Promise(r => setTimeout(r, 50));
            }

            // 3. Move hand to a resting position visible on screen
            handWrapper.style.transition = "left 0.5s ease-in";
            handWrapper.style.left = "95vw"; // Changed from "calc(100% + 200px)"

            await new Promise(r => setTimeout(r, 600));

            // --- PHASE 5: SUCCESS ---
            document.getElementById('success-screen').style.display = 'flex';
            document.querySelectorAll('.charm').forEach(charm => {
                charm.classList.add('celebrate');
            });
        }

        function createSaltParticles(sourceElement, isFallingDown, count = 1) {
            const rect = sourceElement.getBoundingClientRect();
            let startX, startY;

            if (isFallingDown) {
                // Falling from hand pinch (center of hand wrapper)
                startX = rect.left + rect.width / 2;
                startY = rect.top + rect.height / 2 + 30; // Drop from below the pinch point
            } else {
                // Shaking from shaker
                startX = rect.left + rect.width / 2;
                startY = rect.bottom - 20;
            }

            for (let j = 0; j < count; j++) {
                const salt = document.createElement('div');
                salt.classList.add('salt-grain');
                document.body.appendChild(salt);

                // Add slight randomness to X start position
                const randomX = (Math.random() - 0.5) * 20;

                salt.style.left = `${startX + randomX}px`;
                salt.style.top = `${startY}px`;

                let transformTo;
                if (isFallingDown) {
                    // Fall straight down with slight horizontal drift (gravity effect)
                    const driftX = (Math.random() - 0.5) * 50;
                    transformTo = `translate(${driftX}px, 400px)`;
                } else {
                    // Sprinkle onto hand
                    transformTo = `translate(${randomX}px, 80px)`;
                }

                const anim = salt.animate([
                    { transform: `translate(0,0)`, opacity: 1 },
                    { transform: transformTo, opacity: 0 }
                ], {
                    duration: isFallingDown ? 1500 : 600,
                    easing: isFallingDown ? 'linear' : 'ease-in'
                });

                anim.onfinish = () => salt.remove();
            }
        }
    </script>
</body>

</html>